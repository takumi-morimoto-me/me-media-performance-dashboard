# 詳細要件定義：設定ページ

本文書は、「全体要件定義書」に基づき、アプリケーション全体の動作を管理する「設定ページ」に関する機能要件、UI/UX、および具体的な操作フローを詳細に定義するものである。

## 1. 画面概要

本画面は、アプリケーションの管理者および権限を持つユーザーが、システムの基本的な動作、マスターデータ、自動化プロセスなどを一元的に管理するための中心的な画面である。設定項目を「基本設定」「マスターデータ」「自動化・通知」の3つのタブに分類し、直感的で分かりやすい操作性を提供する。

## 2. 機能要件

### 2.1. 基本設定タブ

アプリケーションの会計基準や、ユーザーに関する基本的な設定を管理する。

- **会計期間管理**:
    - **現在の会計期**: 事業の現在の会計期（例：20期）を選択・設定できる。
    - **期首月**: 会計年度の開始月（例：4月）を選択・設定できる。
    - これらの設定は、ダッシュボードや予実管理画面でのデータ集計期間の基準となる。

- **ユーザーと権限の管理**:
    - **ユーザー一覧表示**: システムに登録されている全ユーザーをテーブル形式で一覧表示する。表示項目は「メールアドレス」「役割（ロール）」「担当メディア」。
    - **ユーザー招待**: 新しいユーザーをシステムに招待するためのモーダルを提供する。メールアドレスと役割を指定して招待を送信する。
    - **役割（ロール）変更**: 既存ユーザーの役割や、担当メディアの割り当てを変更できる。
    - **ユーザー削除**: ユーザーをシステムから削除する。削除前には確認ダイアログを表示する。

### 2.2. マスターデータタブ

アプリケーション全体で共通して利用されるマスターデータを管理する。

- **メディア管理**:
    - **メディア一覧表示**: 登録されている全メディアを一覧表示する。表示項目は「メディア名」「Slug」「勘定項目数」「作成日」。
    - **メディア追加・削除**: 新しいメディアの登録、および既存メディアの削除機能を提供する。
        - 追加時にSlugが自動生成される（日本語名をローマ字変換）
        - 削除時には関連データ（予算・実績）への影響について警告を表示する
    - **メディア編集**: メディア名の変更（Slugも自動更新）

- **階層化勘定項目管理**:
    - **大項目・小項目の2階層表示**: 勘定項目を大項目（カテゴリ）と小項目の階層構造で管理
        - 大項目は展開/折りたたみ可能な表示
        - 各大項目に含まれる小項目数を表示
    - **項目追加機能**:
        - 新しい大項目（カテゴリ）の追加
        - 既存大項目配下への小項目追加
        - 表示順序の管理（ドラッグ&ドロップ対応予定）
    - **項目編集・削除**:
        - 大項目・小項目名の変更
        - 不要な項目の削除（小項目削除時は大項目内、大項目削除時は配下全項目削除）
        - 削除前の確認ダイアログ表示
    - **CSVインポート連携**:
        - CSVインポート時の新項目自動作成機能
        - インテリジェントマッピング（類似項目の自動提案）
        - デフォルトテンプレート提供

- **ASP管理**:
    - **ASP一覧表示**: データ連携の対象となるASPを一覧表示する。
    - **ASP追加・削除**: 新しいASPの登録、および既存ASPの削除機能を提供する。

### 2.3. 自動化・通知タブ

実績データ自動収集機能（MCP）の監視と、システムからの通知に関する設定を管理する。

- **MCPステータス監視**:
    - **実行ログ表示**: Cloud Runで実行されたMCPの実行履歴をテーブル形式で一覧表示する。表示項目は「実行日時」「対象ASP」「ステータス（成功/失敗）」「ログへのリンク」。
    - **手動更新**: 最新の実行状況を取得するためのリフレッシュ機能を提供する。

- **通知設定**:
    - **エラー通知先設定**: MCPの実行が失敗した際にアラートを通知する宛先（例：SlackのWebhook URLやメールアドレス）を設定できる。

## 3. UI/UXデザイン (shadcn/ui活用)

- **レイアウト**:
    - 画面全体のナビゲーションとして `Tabs` コンポーネントを使用し、「基本設定」「マスターデータ」「自動化・通知」の各コンテンツを切り替える。
    - 各設定項目は、タイトル付きの `Card` コンポーネント内に整理して配置する。

- **コンポーネント**:
    - テーブル: `Table` コンポーネントを、ユーザー一覧やメディア一覧、実行ログの表示に使用する。
    - モーダル: `Dialog` コンポーネントを、ユーザー招待やマスターデータの追加・編集フォームに使用する。
    - フォーム要素: `Input`（テキスト入力）、`Select`（役割選択など）、`Label` を各設定項目で使用する。
    - ボタン: `Button` コンポーネントを、「保存」「新規追加」「編集」「削除」などのアクションに使用する。
    - 確認ダイアログ: `AlertDialog` コンポーネントを、ユーザーやマスターデータの削除といった破壊的な操作の前に表示し、誤操作を防ぐ。
    - 通知: 設定の保存成功・失敗などのフィードバックは `Toast` コンポーネントで画面隅に表示する。

- **インタラクション**:
    - データの一覧（ユーザー、メディアなど）を読み込み中は、`Skeleton` コンポーネントを表示する。
    - 各種設定の「保存」ボタンは、設定値が変更された場合にのみ活性化状態にする。
    - 削除ボタンなどの危険な操作が可能なボタンは、赤色などの警告色がわかるデザインを適用する。
